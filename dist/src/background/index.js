(function(){"use strict";const L=(t,e)=>e.some(n=>t instanceof n);let G,H;function st(){return G||(G=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function rt(){return H||(H=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const M=new WeakMap,O=new WeakMap,v=new WeakMap;function it(t){const e=new Promise((n,o)=>{const a=()=>{t.removeEventListener("success",r),t.removeEventListener("error",s)},r=()=>{n(w(t.result)),a()},s=()=>{o(t.error),a()};t.addEventListener("success",r),t.addEventListener("error",s)});return v.set(e,t),e}function ct(t){if(M.has(t))return;const e=new Promise((n,o)=>{const a=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",s),t.removeEventListener("abort",s)},r=()=>{n(),a()},s=()=>{o(t.error||new DOMException("AbortError","AbortError")),a()};t.addEventListener("complete",r),t.addEventListener("error",s),t.addEventListener("abort",s)});M.set(t,e)}let j={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return M.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return w(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function q(t){j=t(j)}function dt(t){return rt().includes(t)?function(...e){return t.apply(N(this),e),w(this.request)}:function(...e){return w(t.apply(N(this),e))}}function lt(t){return typeof t=="function"?dt(t):(t instanceof IDBTransaction&&ct(t),L(t,st())?new Proxy(t,j):t)}function w(t){if(t instanceof IDBRequest)return it(t);if(O.has(t))return O.get(t);const e=lt(t);return e!==t&&(O.set(t,e),v.set(e,t)),e}const N=t=>v.get(t);function T(t,e,{blocked:n,upgrade:o,blocking:a,terminated:r}={}){const s=indexedDB.open(t,e),d=w(s);return o&&s.addEventListener("upgradeneeded",l=>{o(w(s.result),l.oldVersion,l.newVersion,w(s.transaction),l)}),n&&s.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),d.then(l=>{r&&l.addEventListener("close",()=>r()),a&&l.addEventListener("versionchange",c=>a(c.oldVersion,c.newVersion,c))}).catch(()=>{}),d}const ut=["get","getKey","getAll","getAllKeys","count"],mt=["put","add","delete","clear"],_=new Map;function K(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(_.get(e))return _.get(e);const n=e.replace(/FromIndex$/,""),o=e!==n,a=mt.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(a||ut.includes(n)))return;const r=async function(s,...d){const l=this.transaction(s,a?"readwrite":"readonly");let c=l.store;return o&&(c=c.index(d.shift())),(await Promise.all([c[n](...d),a&&l.done]))[0]};return _.set(e,r),r}q(t=>({...t,get:(e,n,o)=>K(e,n)||t.get(e,n,o),has:(e,n)=>!!K(e,n)||t.has(e,n)}));const ft=["continue","continuePrimaryKey","advance"],z={},P=new WeakMap,J=new WeakMap,gt={get(t,e){if(!ft.includes(e))return t[e];let n=z[e];return n||(n=z[e]=function(...o){P.set(this,J.get(this)[e](...o))}),n}};async function*ht(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,gt);for(J.set(n,e),v.set(n,N(e));e;)yield n,e=await(P.get(n)||e.continue()),P.delete(n)}function Q(t,e){return e===Symbol.asyncIterator&&L(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&L(t,[IDBIndex,IDBObjectStore])}q(t=>({...t,get(e,n,o){return Q(e,n)?ht:t.get(e,n,o)},has(e,n){return Q(e,n)||t.has(e,n)}}));const wt=[{name:"Read Later",emoji:"üìñ"},{name:"Reference",emoji:"üìå"},{name:"Share",emoji:"üîó"},{name:"Project",emoji:"üìÅ"}],pt=["#818cf8","#34d399","#fbbf24","#f87171","#38bdf8","#a78bfa","#fb7185","#2dd4bf"],k={"github.com":"Development","gitlab.com":"Development","stackoverflow.com":"Development","dev.to":"Development","npmjs.com":"Development","docs.python.org":"Development","developer.mozilla.org":"Development","medium.com":"Articles","substack.com":"Articles","hashnode.com":"Articles","blog.":"Articles","youtube.com":"Videos","vimeo.com":"Videos","twitch.tv":"Videos","twitter.com":"Social","x.com":"Social","linkedin.com":"Social","reddit.com":"Social","facebook.com":"Social","news.ycombinator.com":"Tech News","techcrunch.com":"Tech News","theverge.com":"Tech News","arstechnica.com":"Tech News","wired.com":"Tech News","arxiv.org":"Research","scholar.google.com":"Research","researchgate.net":"Research","nature.com":"Research","sciencedirect.com":"Research","figma.com":"Design","dribbble.com":"Design","behance.net":"Design","awwwards.com":"Design","openai.com":"AI","anthropic.com":"AI","huggingface.co":"AI"},U=3,B="resurface",X=1,yt=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","from","is","are","was","were","be","been","being","have","has","had","do","does","did","will","would","could","should","may","might","must","shall","can","need","how","what","when","where","why","who","which","this","that","these","those","i","you","he","she","it","we","they","my","your","his","her","its","our","their","me","him","us","them","just","only","also","very","too","so","than","then","now","here","there","all","each","every","both","few","more","most","other","some","such","no","not","any","new","first","last","long","great","little","own","same","right","big","high","different","small","large","next","early","young","important","public","bad","good","best","well","way","use","using","used","get","getting","got","make","making","made","part","full","complete","guide","tutorial","introduction","intro","overview"]);let D;const It=new Uint8Array(16);function bt(){if(!D&&(D=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!D))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return D(It)}const u=[];for(let t=0;t<256;++t)u.push((t+256).toString(16).slice(1));function St(t,e=0){return u[t[e+0]]+u[t[e+1]]+u[t[e+2]]+u[t[e+3]]+"-"+u[t[e+4]]+u[t[e+5]]+"-"+u[t[e+6]]+u[t[e+7]]+"-"+u[t[e+8]]+u[t[e+9]]+"-"+u[t[e+10]]+u[t[e+11]]+u[t[e+12]]+u[t[e+13]]+u[t[e+14]]+u[t[e+15]]}const Y={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function vt(t,e,n){if(Y.randomUUID&&!t)return Y.randomUUID();t=t||{};const o=t.random||(t.rng||bt)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,St(o)}function A(){return vt()}function g(){return Date.now()}function y(t){try{const{hostname:e}=new URL(t);return e.replace("www.","")}catch{return""}}function Z(t){return t.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(e=>e.length>2&&!yt.has(e)&&!/^\d+$/.test(e)).slice(0,5)}function Tt(t){return t.charAt(0).toUpperCase()+t.slice(1)}function W(t){const e=Math.floor((Date.now()-t)/1e3);if(e<60)return"Just now";const n=Math.floor(e/60);if(n<60)return`${n}m ago`;const o=Math.floor(n/60);if(o<24)return`${o}h ago`;const a=Math.floor(o/24);if(a<7)return`${a}d ago`;const r=Math.floor(a/7);if(r<4)return`${r}w ago`;const s=Math.floor(a/30);return s<12?`${s}mo ago`:`${Math.floor(a/365)}y ago`}function Dt(t,e,n){return[t.toLowerCase(),e.toLowerCase(),(n==null?void 0:n.toLowerCase())||""].join(" ").trim()}function At(t,e){const n=t.filter(o=>!e.includes(o));return n.length===0?t[Math.floor(Math.random()*t.length)]:n[Math.floor(Math.random()*n.length)]}const tt="tabmind";let p=null;async function m(){return console.log("Resurface Storage: ensureDb called, db exists:",!!p),p||(console.log("Resurface Storage: DB not initialized, calling initStorage..."),await $(),console.log("Resurface Storage: initStorage completed, db exists:",!!p)),p}async function $(){p||(await Rt(),p=await T(B,X,{upgrade(t,e,n){if(console.log(`Resurface Storage: Upgrading DB from v${e} to v${n}`),!t.objectStoreNames.contains("savedItems")){const o=t.createObjectStore("savedItems",{keyPath:"id"});o.createIndex("by-url","url"),o.createIndex("by-savedAt","savedAt"),o.createIndex("by-searchText","searchText")}t.objectStoreNames.contains("topics")||t.createObjectStore("topics",{keyPath:"id"}).createIndex("by-name","name"),t.objectStoreNames.contains("intents")||t.createObjectStore("intents",{keyPath:"id"}).createIndex("by-name","name"),t.objectStoreNames.contains("settings")||t.createObjectStore("settings",{keyPath:"id"})}}),await Et())}async function Rt(){try{if(!(await indexedDB.databases()).some(i=>i.name===tt)){console.log("Resurface Storage: No old TabMind database found, skipping migration");return}console.log("Resurface Storage: Found old TabMind database, starting migration...");const n=await T(tt,1);let o=!1;try{const i=await T(B,1);o=(await i.getAll("savedItems")).length>0,i.close()}catch{}if(o){console.log("Resurface Storage: New database already has data, skipping migration"),n.close();return}const a=await n.getAll("savedItems"),r=await n.getAll("topics"),s=await n.getAll("intents"),d=await n.get("settings","main");console.log(`Resurface Storage: Migrating ${a.length} items, ${r.length} topics, ${s.length} intents`),n.close();const l=await T(B,X,{upgrade(i){if(!i.objectStoreNames.contains("savedItems")){const f=i.createObjectStore("savedItems",{keyPath:"id"});f.createIndex("by-url","url"),f.createIndex("by-savedAt","savedAt"),f.createIndex("by-searchText","searchText")}i.objectStoreNames.contains("topics")||i.createObjectStore("topics",{keyPath:"id"}).createIndex("by-name","name"),i.objectStoreNames.contains("intents")||i.createObjectStore("intents",{keyPath:"id"}).createIndex("by-name","name"),i.objectStoreNames.contains("settings")||i.createObjectStore("settings",{keyPath:"id"})}}),c=l.transaction(["savedItems","topics","intents","settings"],"readwrite");for(const i of a)await c.objectStore("savedItems").put(i);for(const i of r)await c.objectStore("topics").put(i);for(const i of s)await c.objectStore("intents").put(i);d&&await c.objectStore("settings").put(d),await c.done,l.close(),console.log("Resurface Storage: Migration completed successfully!")}catch(t){console.error("Resurface Storage: Migration error (non-fatal):",t)}}async function Et(){const t=await m();if((await t.getAll("intents")).length===0)for(const o of wt)await t.add("intents",{id:A(),name:o.name,emoji:o.emoji,createdAt:g(),itemCount:0});await t.get("settings","main")||await t.add("settings",{id:"main",keyboardShortcut:"Cmd+Shift+S",autoSaveDelay:5e3,showResurfaceDropdown:!0,defaultIntentId:null})}async function xt(t){console.log("Resurface Storage: saveItem called with:",t.url);try{const e=await m();console.log("Resurface Storage: Got database reference"),console.log("Resurface Storage: Checking for existing item with URL:",t.url);const n=await e.getFromIndex("savedItems","by-url",t.url);if(console.log("Resurface Storage: Existing item found:",!!n),n){console.log("Resurface Storage: Updating existing item");const o={...n,...t,id:n.id,savedAt:n.savedAt,lastAccessedAt:g()};return await e.put("savedItems",o),console.log("Resurface Storage: Item updated successfully"),o}return console.log("Resurface Storage: Adding new item..."),await e.add("savedItems",t),console.log("Resurface Storage: Item added to database"),console.log("Resurface Storage: Updating topic counts for:",t.topicIds),await x(t.topicIds,1),console.log("Resurface Storage: Updating intent counts for:",t.intentIds),await C(t.intentIds,1),console.log("Resurface Storage: saveItem completed successfully"),t}catch(e){throw console.error("Resurface Storage: Error in saveItem:",e),e}}async function Ct(t){return(await m()).getFromIndex("savedItems","by-url",t)}async function et(){return(await(await m()).getAll("savedItems")).sort((n,o)=>o.savedAt-n.savedAt)}async function R(t,e=10){const n=await m(),o=t.toLowerCase().trim();if(!o)return[];const a=await n.getAll("savedItems"),r=o.split(/\s+/);return a.filter(s=>r.some(d=>s.searchText.includes(d))).sort((s,d)=>{const l=r.filter(i=>s.searchText.includes(i)).length,c=r.filter(i=>d.searchText.includes(i)).length;return c!==l?c-l:d.savedAt-s.savedAt}).slice(0,e)}async function Lt(t,e){const n=await m(),o=await n.get("savedItems",t);if(!o)return null;const a=o.topicIds,r=o.intentIds,s={...o,...e,lastAccessedAt:g()};if(await n.put("savedItems",s),e.topicIds){const d=a.filter(c=>!e.topicIds.includes(c)),l=e.topicIds.filter(c=>!a.includes(c));await x(d,-1),await x(l,1)}if(e.intentIds){const d=r.filter(c=>!e.intentIds.includes(c)),l=e.intentIds.filter(c=>!r.includes(c));await C(d,-1),await C(l,1)}return s}async function Mt(t){const e=await m(),n=await e.get("savedItems",t);return n?(await e.delete("savedItems",t),await x(n.topicIds,-1),await C(n.intentIds,-1),!0):!1}async function I(){return(await(await m()).getAll("topics")).sort((n,o)=>o.itemCount-n.itemCount)}async function E(t,e=!1){const n=await m(),o=t.trim(),a=await n.getFromIndex("topics","by-name",o);if(a)return a;const s=(await n.getAll("topics")).map(l=>l.color),d={id:A(),name:o,color:At(pt,s),isAutoGenerated:e,createdAt:g(),itemCount:0};return await n.add("topics",d),d}async function Ot(t){return E(t,!1)}async function x(t,e){const n=await m();for(const o of t){const a=await n.get("topics",o);a&&(a.itemCount=Math.max(0,a.itemCount+e),await n.put("topics",a))}}async function b(){return(await(await m()).getAll("intents")).sort((n,o)=>o.itemCount-n.itemCount)}async function jt(t,e){const n=await m(),o={id:A(),name:t.trim(),emoji:e,createdAt:g(),itemCount:0};return await n.add("intents",o),o}async function C(t,e){const n=await m();for(const o of t){const a=await n.get("intents",o);a&&(a.itemCount=Math.max(0,a.itemCount+e),await n.put("intents",a))}}async function S(){return await(await m()).get("settings","main")}async function nt(t){const e=await m(),o={...await S(),...t};return await e.put("settings",o),o}async function Nt(){const t=await m(),e=await t.getAll("savedItems"),n=await t.getAll("topics"),o=await t.getAll("intents"),a=await t.get("settings","main");return{version:"1.0.0",exportedAt:g(),items:e,topics:n,intents:o,settings:a||void 0}}async function _t(t,e){const n=await m();try{if(console.log(`Resurface Storage: Importing data in ${e} mode`),console.log(`Resurface Storage: Data contains ${t.items.length} items, ${t.topics.length} topics, ${t.intents.length} intents`),!t.items||!t.topics||!t.intents)throw new Error("Invalid backup format: missing required fields");let o=0,a=0,r=0;if(e==="replace"){const s=n.transaction(["savedItems","topics","intents"],"readwrite");await s.objectStore("savedItems").clear(),await s.objectStore("topics").clear(),await s.objectStore("intents").clear(),await s.done,console.log("Resurface Storage: Cleared existing data for replace mode")}for(const s of t.topics)try{e==="merge"?await n.getFromIndex("topics","by-name",s.name)||(await n.add("topics",s),a++):(await n.put("topics",s),a++)}catch(d){console.warn("Resurface Storage: Error importing topic:",s.name,d)}for(const s of t.intents)try{e==="merge"?await n.getFromIndex("intents","by-name",s.name)||(await n.add("intents",s),r++):(await n.put("intents",s),r++)}catch(d){console.warn("Resurface Storage: Error importing intent:",s.name,d)}for(const s of t.items)try{e==="merge"?await n.getFromIndex("savedItems","by-url",s.url)||(await n.add("savedItems",s),o++):(await n.put("savedItems",s),o++)}catch(d){console.warn("Resurface Storage: Error importing item:",s.url,d)}return t.settings&&e==="replace"&&await n.put("settings",t.settings),console.log(`Resurface Storage: Import completed - ${o} items, ${a} topics, ${r} intents`),{success:!0,imported:{items:o,topics:a,intents:r}}}catch(o){throw console.error("Resurface Storage: Import error:",o),o}}async function Pt(t){const e=[],n=new Set,o=await kt(t.url);o&&!n.has(o.name.toLowerCase())&&(e.push(o),n.add(o.name.toLowerCase()));const a=await I(),r=Z(t.title),s=t.referrerQuery?Z(t.referrerQuery):[],d=[...new Set([...s,...r])];for(const l of d){if(e.length>=U)break;const c=Ut(l,a);c&&!n.has(c.name.toLowerCase())&&(e.push(c),n.add(c.name.toLowerCase()))}if(e.length<U&&d.length>0)for(const l of d){if(e.length>=U)break;const c=Tt(l);if(!n.has(c.toLowerCase())&&l.length>=3&&Bt(l)){const i=await E(c,!0);e.push(i),n.add(c.toLowerCase())}}return e}async function kt(t){const e=y(t);if(k[e])return E(k[e],!0);for(const[n,o]of Object.entries(k))if(n.endsWith(".")&&e.includes(n))return E(o,!0);return null}function Ut(t,e){const n=t.toLowerCase(),o=e.find(r=>r.name.toLowerCase()===n);if(o)return o;const a=e.find(r=>{const s=r.name.toLowerCase();return s.includes(n)||n.includes(s)});return a||null}function Bt(t){return!(t.length<3||new Set(["app","web","site","page","post","blog","news","article","home","about","contact","help","faq","terms","privacy","login","signup","register","account","profile","settings","search","results","list","view","edit","create","delete","file","files","folder","document","image","video","audio","free","pro","premium","trial","demo","beta","alpha","online","digital","virtual","mobile","desktop","cloud"]).has(t.toLowerCase())||/^\d+$/.test(t))}function Wt(t,e){return{type:t,payload:e}}async function h(t,e,n){return chrome.tabs.sendMessage(t,Wt(e,n))}chrome.runtime.onInstalled.addListener(async()=>{await $(),await V(),console.log("Resurface installed and initialized")}),chrome.runtime.onStartup.addListener(async()=>{await $(),await V(),console.log("Resurface started")});async function V(){const e=(await chrome.commands.getAll()).find(n=>n.name==="save-tab");e!=null&&e.shortcut&&await nt({keyboardShortcut:e.shortcut})}chrome.commands.onCommand.addListener(async t=>{t==="save-tab"?await F():t==="resurface"&&await $t()}),chrome.omnibox.onInputChanged.addListener(async(t,e)=>{if(t.length<2){e([]);return}const o=(await R(t,6)).map(a=>({content:a.url,description:`<match>${ot(a.title)}</match> <dim>- ${ot(y(a.url))}</dim>`}));e(o)}),chrome.omnibox.onInputEntered.addListener(async(t,e)=>{let n;switch(t.startsWith("http://")||t.startsWith("https://")?n=t:n=chrome.runtime.getURL(`src/dashboard/index.html?search=${encodeURIComponent(t)}`),e){case"currentTab":chrome.tabs.update({url:n});break;case"newForegroundTab":chrome.tabs.create({url:n});break;case"newBackgroundTab":chrome.tabs.create({url:n,active:!1});break}});function ot(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}chrome.action.onClicked.addListener(async t=>{t.id&&await F()});async function at(t){try{await chrome.tabs.sendMessage(t,{type:"PING"})}catch{console.log("Content script not found, injecting..."),await chrome.scripting.executeScript({target:{tabId:t},files:["src/content/index.js"]}),await chrome.scripting.insertCSS({target:{tabId:t},files:["src/content/styles.css"]}),await new Promise(e=>setTimeout(e,100))}}async function $t(){const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(t!=null&&t.id)||!t.url){console.log("No active tab or URL");return}if(!t.url.startsWith("http://")&&!t.url.startsWith("https://")){chrome.tabs.create({url:chrome.runtime.getURL("src/dashboard/index.html")});return}try{await at(t.id);const e=await et(),n=await I(),o=await b(),a=e.slice(0,20).map(r=>({id:r.id,title:r.title,url:r.url,favicon:r.favicon,faviconType:r.faviconType,domain:y(r.url),savedAt:W(r.savedAt),topics:n.filter(s=>r.topicIds.includes(s.id)),intents:o.filter(s=>r.intentIds.includes(s.id))}));await h(t.id,"SHOW_SEARCH_MODAL",{items:a})}catch(e){console.error("Error in resurface command:",e)}}async function F(){const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(t!=null&&t.id)||!t.url){console.log("No active tab or URL");return}if(!t.url.startsWith("http://")&&!t.url.startsWith("https://")){console.log("Cannot save restricted URL:",t.url);return}try{await at(t.id);const e=await Ct(t.url);if(e){await h(t.id,"SHOW_ALREADY_SAVED",{item:e});return}const n=await h(t.id,"EXTRACT_PAGE"),a=(await chrome.tabs.query({windowId:t.windowId})).filter(c=>{var i;return c.id!==t.id&&((i=c.url)==null?void 0:i.startsWith("http"))}).map(c=>c.url).slice(0,10),r=await Pt({url:n.url,title:n.title,referrerQuery:n.referrerQuery}),s=await b(),d=await S(),l={pageData:n,suggestedTopics:r,intents:s,siblingTabUrls:a,autoSaveDelay:d.autoSaveDelay};h(t.id,"SHOW_TOAST",l).catch(c=>{console.error("Error showing toast:",c)})}catch(e){console.error("Error in save command:",e)}}chrome.runtime.onMessage.addListener((t,e,n)=>{const o=Vt[t.type];return o?(o(t.payload,e).then(n).catch(a=>{console.error(`Error handling ${t.type}:`,a),n({error:a.message})}),!0):(console.warn("Unknown message type:",t.type),!1)});const Vt={async SAVE_ITEM(t){console.log("Resurface Background: ========== SAVE_ITEM RECEIVED =========="),console.log("Resurface Background: Payload:",JSON.stringify(t,null,2));try{const{pageData:e,toastResult:n,siblingTabUrls:o}=t;console.log("Resurface Background: Creating item object...");const a={id:A(),url:e.url,title:n.title,favicon:e.favicon,faviconType:e.faviconType,savedAt:g(),lastAccessedAt:g(),referrerQuery:e.referrerQuery,referrerUrl:e.referrerUrl,siblingTabUrls:o,topicIds:n.topicIds,intentIds:n.intentIds,searchText:Dt(n.title,e.url,e.referrerQuery)};console.log("Resurface Background: Item created:",JSON.stringify(a,null,2)),console.log("Resurface Background: Calling saveItem...");const r=await xt(a);return console.log("Resurface Background: ========== ITEM SAVED SUCCESSFULLY =========="),console.log("Resurface Background: Saved item:",JSON.stringify(r,null,2)),r}catch(e){throw console.error("Resurface Background: ========== SAVE_ITEM ERROR =========="),console.error("Resurface Background: Error:",e),e}},async SEARCH_ITEMS(t){return R(t.query)},async GET_ALL_ITEMS(){return et()},async GET_ALL_TOPICS(){return I()},async GET_ALL_INTENTS(){return b()},async DELETE_ITEM(t){return Mt(t.id)},async UPDATE_ITEM(t){return Lt(t.id,t.updates)},async CREATE_TOPIC(t){return Ot(t.name)},async CREATE_INTENT(t){return jt(t.name,t.emoji)},async URL_INPUT(t,e){var s;const{query:n}=t,o=(s=e.tab)==null?void 0:s.id;if(!o||!(await S()).showResurfaceDropdown)return;if(n.length<2){await h(o,"HIDE_DROPDOWN");return}const r=await R(n,5);if(r.length>0){const d=await I(),l=await b(),c=r.map(i=>({id:i.id,title:i.title,url:i.url,favicon:i.favicon,faviconType:i.faviconType,domain:y(i.url),savedAt:W(i.savedAt),topics:d.filter(f=>i.topicIds.includes(f.id)),intents:l.filter(f=>i.intentIds.includes(f.id))}));await h(o,"SHOW_DROPDOWN",{items:c})}else await h(o,"HIDE_DROPDOWN")},async TRIGGER_SAVE(){await F()},async GET_SETTINGS(){return await V(),S()},async UPDATE_SETTINGS(t){return nt(t)},async EXPORT_DATA(){return Nt()},async IMPORT_DATA(t){return _t(t.data,t.mode)}};chrome.tabs.onUpdated.addListener(async(t,e,n)=>{if(e.status==="complete"&&n.url){if(!(await S()).showResurfaceDropdown)return;const a=n.url.match(/google\.[a-z.]+\/search\?.*q=([^&]+)/);if(a){const r=decodeURIComponent(a[1].replace(/\+/g," ")),s=await R(r,5);if(s.length>0)try{const d=await I(),l=await b(),c=s.map(i=>({id:i.id,title:i.title,url:i.url,favicon:i.favicon,faviconType:i.faviconType,domain:y(i.url),savedAt:W(i.savedAt),topics:d.filter(f=>i.topicIds.includes(f.id)),intents:l.filter(f=>i.intentIds.includes(f.id))}));await h(t,"SHOW_GOOGLE_OVERLAY",{items:c,query:r})}catch{}}}})})();
